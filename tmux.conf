# Quoc Hung Le's Tmux Configurations

# General Settings {{{

# Local custom config
if-shell "[ -f ~/.tmux.conf.user ]" 'source ~/.tmux.conf.user'

# Use Mouse
set -g mouse on

# Bigger history
set -g history-limit 10000

# Display visual bell
set -g visual-bell on

# Ring the bell if any background window rang a bell
set -g bell-action any

# Renumber windows sequentially after closing any of them
set -g renumber-windows on

# Using True Color
set -ga terminal-overrides ",xterm-256color:Tc"

# Cursor shape change in tmux
set -ga terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[2 q'

# Shorten command delay
set -sg escape-time 1

# Set first window to index 1 (not 0) to map more to the keyboard layout...
set -g base-index 1

# Setting panes index, start from 1.
setw -g pane-base-index 1

# Use vi keybindings for tmux commandline input.
set -g status-keys vi

# Use vi keybindings in copy and choice modes
setw -g mode-keys vi

# Command/Message
set -g message-fg colour252
set -g message-bg colour39
set -g message-attr bright
# }}}

# Key Bindings {{{

# Update default binding of `Enter` to also use copy-pipe
unbind -t vi-copy Enter

# Remove Ctrl-b as default prefix key
unbind C-b

# Set Ctrl-a set prefix key
set -g prefix C-a

# Ctrl-a twice to send Ctrl-a to an app running inside tmux
bind a send-prefix

# Reload tmux config
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# Rename windows & session
bind n command-prompt 'rename-window %%'
bind N command-prompt 'rename-session %%'

# Setup 'v' to begin selection as in Vim
bind -t vi-copy v begin-selection
bind -t vi-copy y copy-pipe "reattach-to-user-namespace pbcopy"
bind -t vi-copy Enter copy-pipe "reattach-to-user-namespace pbcopy"
# Patch for OS X pbpaste and pbcopy under tmux.
set-option -g default-command "which reattach-to-user-namespace > /dev/null && reattach-to-user-namespace -l $SHELL || $SHELL"
# }}}

# Windows & Panes {{{

# Kill pane
bind -n C-x kill-pane

# Create new windows
bind c new-window -c "#{pane_current_path}"

# Create horizontal splits
bind - split-window -v -c "#{pane_current_path}"

# Create vertical splits
bind \ split-window -h -c "#{pane_current_path}"

# Break pane into a single windows
bind b break-pane -d

# Switching between tmux and vim splits seamlessly
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"

# Cycle through the windows
bind , previous-window
bind . next-window

# Resizing
bind -n S-Left  resize-pane -L 2
bind -n S-Right resize-pane -R 2
bind -n S-Up    resize-pane -U 1
bind -n S-Down  resize-pane -D 1

# }}}

# Status Bar {{{

# Always show status bar
set -g status on

# Set update frequencey (default 15 seconds)
set -g status-interval 5

# White text on black background
set -g status-fg colour252
set -g status-bg colour234

# Status bar left side
set -g status-left-length 52
set -g status-left "#{prefix_highlight}#[fg=colour235,bg=colour252,nobold] ❐ #S #{online_status} #[fg=colour252,bg=colour234,nobold]⮀"

# # # Status bar right side
set -g status-right-length 451
set -g status-right "#[fg=colour238,bg=colour234,nobold]⮂#[fg=colour252,bg=colour238,nobold] %a %h.%d.%Y %H:%M #[fg=colour39]⮂#[fg=colour234,bg=colour39,nobold] ⓦ #(curl icanhazip.com) #[fg=colour252]⮂#[fg=colour234,bg=colour252,nobold] ⌘ #h "

# # Windows list customizations
set -g window-status-format "#[fg=colour234,bg=colour252]⮀#[fg=colour234,bg=colour252,nobold] #I:#W #[fg=colour252,bg=colour234,nobold]⮀"
set -g window-status-current-format "#[fg=colour234,bg=colour39]⮀#[fg=colour234,bg=colour39,noreverse,nobold] #I:#W #[fg=colour39,bg=colour234,nobold]⮀"
# }}}

# Plugins {{{
set -g @plugin 'tmux-plugins/tpm'                # Tmux Plugins Manager
set -g @plugin 'tmux-plugins/tmux-yank'          # Enables copying to system clipboard in Tmux
set -g @plugin 'tmux-plugins/tmux-sensible'      # A set of tmux options that should be acceptable to everyone
set -g @plugin 'tmux-plugins/tmux-copycat'       # Enhances tmux search
set -g @plugin 'tmux-plugins/tmux-resurrect'     # Restore tmux environment after system restart.
set -g @plugin 'tmux-plugins/tmux-sidebar'       # Opens a tree directory listing for the current path
set -g @plugin 'tmux-plugins/tmux-online-status' # Tmux plugin that displays online status of your computer.
set -g @plugin 'tmux-plugins/tmux-open'          # Tmux key bindings for quick opening of a highlighted file or url
set -g @plugin 'tmux-plugins/tmux-continuum'     # Continuous saving of tmux environment
set -g @plugin 'tmux-plugins/tmux-prefix-highlight' # Highlights when you press tmux prefix key

# Online status symbols
set -g @online_icon "✓"
set -g @offline_icon "✗"

# Tmux prefix highlight
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=black,bg=yellow,bold' # default is 'fg=default,bg=yellow'

# Automatic Restore Tmux Environment
set -g @continuum-restore 'off'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
# }}}

# vim:foldmethod=marker:foldlevel=0